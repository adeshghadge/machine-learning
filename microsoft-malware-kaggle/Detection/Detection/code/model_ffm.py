import xlearn as xl
import pandas as pd

# create ffm model
ffm_model = xl.create_ffm() 

ffm_model.disableLockFree()

# set training and validation data
#ffm_model.setTrain("train.libffm")
#ffm_model.setValidate("valid.libffm")
#ffm_model.setTXTModel("model.txt")

# define params
param = {'task':'binary', 
         'lr':0.2, 
         'k':4,
         'lambda':0.0002, 
         'metric':'auc', 
         'epoch': 25,
         'nthread': 16}

# train the model
#ffm_model.fit(param, 'model.out')

# set the test data
ffm_model.setTest("test.libffm")
ffm_model.setSigmoid()

# make predictions
ffm_model.predict("model.out", "output.txt")

# create submission file
sample = pd.read_csv('../data/sample_submission.csv')
output = pd.read_csv('output.txt', header=None)[0].values
sample.HasDetections = output
sample.to_csv('../data/submission.csv', index=False)
